<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Validate Transaction | Developer Docs</title>
    <meta name="description" content="Shardus Documentation Developer Docs">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/docs2/assets/css/0.styles.a15dee42.css" as="style"><link rel="preload" href="/docs2/assets/js/app.4fedb86a.js" as="script"><link rel="preload" href="/docs2/assets/js/2.3fd0cf3c.js" as="script"><link rel="preload" href="/docs2/assets/js/56.a43a8ca0.js" as="script"><link rel="prefetch" href="/docs2/assets/js/10.c8f90647.js"><link rel="prefetch" href="/docs2/assets/js/11.37afdd34.js"><link rel="prefetch" href="/docs2/assets/js/12.d4808882.js"><link rel="prefetch" href="/docs2/assets/js/13.89c0170a.js"><link rel="prefetch" href="/docs2/assets/js/14.0650ba29.js"><link rel="prefetch" href="/docs2/assets/js/15.6b3c6a63.js"><link rel="prefetch" href="/docs2/assets/js/16.94b4b93c.js"><link rel="prefetch" href="/docs2/assets/js/17.e52dce7c.js"><link rel="prefetch" href="/docs2/assets/js/18.805f0b18.js"><link rel="prefetch" href="/docs2/assets/js/19.64845a7b.js"><link rel="prefetch" href="/docs2/assets/js/20.395bbe02.js"><link rel="prefetch" href="/docs2/assets/js/21.060e90c4.js"><link rel="prefetch" href="/docs2/assets/js/22.69ee7234.js"><link rel="prefetch" href="/docs2/assets/js/23.730f4a89.js"><link rel="prefetch" href="/docs2/assets/js/24.e9661cf2.js"><link rel="prefetch" href="/docs2/assets/js/25.b88ed052.js"><link rel="prefetch" href="/docs2/assets/js/26.0a46c1b0.js"><link rel="prefetch" href="/docs2/assets/js/27.d1a5d31e.js"><link rel="prefetch" href="/docs2/assets/js/28.b03d88a5.js"><link rel="prefetch" href="/docs2/assets/js/29.926bb12f.js"><link rel="prefetch" href="/docs2/assets/js/3.d41181b0.js"><link rel="prefetch" href="/docs2/assets/js/30.fc7d3d57.js"><link rel="prefetch" href="/docs2/assets/js/31.d4e4aa7d.js"><link rel="prefetch" href="/docs2/assets/js/32.b4459487.js"><link rel="prefetch" href="/docs2/assets/js/33.3a0ede7d.js"><link rel="prefetch" href="/docs2/assets/js/34.86c50212.js"><link rel="prefetch" href="/docs2/assets/js/35.89be3532.js"><link rel="prefetch" href="/docs2/assets/js/36.09e568d9.js"><link rel="prefetch" href="/docs2/assets/js/37.ea9bfe32.js"><link rel="prefetch" href="/docs2/assets/js/38.0c09315a.js"><link rel="prefetch" href="/docs2/assets/js/39.d5eba328.js"><link rel="prefetch" href="/docs2/assets/js/4.bdc95c51.js"><link rel="prefetch" href="/docs2/assets/js/40.f134f176.js"><link rel="prefetch" href="/docs2/assets/js/41.2edff556.js"><link rel="prefetch" href="/docs2/assets/js/42.49878b4e.js"><link rel="prefetch" href="/docs2/assets/js/43.c99e0426.js"><link rel="prefetch" href="/docs2/assets/js/44.6bce92a7.js"><link rel="prefetch" href="/docs2/assets/js/45.efc9c512.js"><link rel="prefetch" href="/docs2/assets/js/46.567954e6.js"><link rel="prefetch" href="/docs2/assets/js/47.ac9ca5d5.js"><link rel="prefetch" href="/docs2/assets/js/48.e64957d7.js"><link rel="prefetch" href="/docs2/assets/js/49.1cdf48ac.js"><link rel="prefetch" href="/docs2/assets/js/5.70dbfd4e.js"><link rel="prefetch" href="/docs2/assets/js/50.a66c1e36.js"><link rel="prefetch" href="/docs2/assets/js/51.024c1df3.js"><link rel="prefetch" href="/docs2/assets/js/52.01271f85.js"><link rel="prefetch" href="/docs2/assets/js/53.e7bf447f.js"><link rel="prefetch" href="/docs2/assets/js/54.44e77f2a.js"><link rel="prefetch" href="/docs2/assets/js/55.da9796f2.js"><link rel="prefetch" href="/docs2/assets/js/57.192b008d.js"><link rel="prefetch" href="/docs2/assets/js/58.b6af1112.js"><link rel="prefetch" href="/docs2/assets/js/6.e910ed1d.js"><link rel="prefetch" href="/docs2/assets/js/7.6d6a826f.js"><link rel="prefetch" href="/docs2/assets/js/8.a3f31b66.js"><link rel="prefetch" href="/docs2/assets/js/9.0a5314d4.js">
    <link rel="stylesheet" href="/docs2/assets/css/0.styles.a15dee42.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs2/" class="home-link router-link-active"><img src="/docs2/logo.png" alt="Developer Docs" class="logo"> <span class="site-name can-hide">Developer Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Installation</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Main Concepts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SDK Reference</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/docs2/source/sdk-reference/shardus-app-interface/source/sdk-reference/shardus-app-interface/shardus-app-interface.html" class="sidebar-heading clickable open"><span>Shardus App Interface</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs2/source/sdk-reference/shardus-app-interface/apply.html" class="sidebar-link">Apply</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/calculate-account-hash.html" class="sidebar-link">Calculate account hash</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/close.html" class="sidebar-link">Close</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/delete-account-data.html" class="sidebar-link">Delete Account Data</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/get-account-data-by-list.html" class="sidebar-link">getAccountDataByList</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/get-account-data-by-range.html" class="sidebar-link">getAccountDataByRange</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/get-account-data.html" class="sidebar-link">Get account data</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/get-account-debug-value.html" class="sidebar-link">Get account debug value</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/get-key-from-transaction.html" class="sidebar-link">Get key from transaction</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/get-relevant-data.html" class="sidebar-link">Get relevant data</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/register-external-get.html" class="sidebar-link">Register External Get</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/register-external-post.html" class="sidebar-link">Register External Post</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/reset-account-data.html" class="sidebar-link">Reset Account Data</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/update-account-full.html" class="sidebar-link">Update account full</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/validate-transaction-fields.html" class="sidebar-link">Validate Transaction Fields</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/validate-transaction.html" class="active sidebar-link">Validate Transaction</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/docs2/source/sdk-reference/configuration-parameters/configuration-parameters.html" class="sidebar-heading clickable"><span>Configuration Parameters</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><a href="/docs2/source/support-and-feedback/raise-an-issue-on-gitlab.html" class="sidebar-link">Support and Feedback</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="validatetransaction"><a href="#validatetransaction" class="header-anchor">#</a> validateTransaction</h1> <p>Shardus expects a function called <code>validateTransaction</code> to be passed in to <code>setup</code>. This function is provided with the transaction as an argument passed into the function.</p> <p>The purpose of this function is to generate a response object with the result of the validation, and reasoning for that result. Essentially, this should make sure everything in the transaction is trusted and won't have any issues when it gets applied to your application state data. Shardus expects this function to return an object, and for that object to be named <code>response</code>. <code>response</code> should contain <code>result</code> and <code>reason</code> fields associated with it. The <code>result</code> field should end up getting set to a string <code>&quot;pass&quot;</code> or <code>&quot;fail&quot;</code>. The <code>reason</code> field should give a descriptive reason for why the transaction ended up with the provided <code>result</code>.</p> <blockquote><p>Giving descriptive reasoning for why transactions fail is <strong>VERY</strong> helpful when debugging your application. Whenever a transaction fails, you can navigate to the fatal file in the <em>logs</em> directory to find out why, and your descriptive reason will be very helpful there.</p></blockquote> <blockquote><p>A good way of implementing this function is to use a <code>switch</code> statement and add cases for the different transaction types that your application expects. Declare the response object with the proper fields at the top of the function with an initial state that assumes failure. Write multiple conditionals that check the requirements of the transaction type, and if it fails that conditional, assign the reason field descriptively and return the result. If the code passes all the conditionals, set the result to <code>&quot;pass&quot;</code> and set the reason to <code>&quot;This transaction is valid!&quot;</code>. You can set the reason to whatever you want, just make it descriptive. In the case that the default branch of the switch statement is reached, the transaction didn't fit any of the types implemented by your application, so a proper failed reasoning would be that the transaction type must be of type A, B, or C...</p></blockquote> <blockquote><p>It's important to verify things like <strong>signatures</strong> within this function. The client should create a transaction and sign it immediately with public and private keys. If something were to intercept the transaction or attempt was made to modify it, verifyObj(tx) would return false and it wouldn't get applied.</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">validateTransaction</span><span class="token punctuation">(</span><span class="token parameter">tx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token punctuation">{</span>
    result<span class="token operator">:</span> <span class="token string">&quot;fail&quot;</span><span class="token punctuation">,</span>
    reason<span class="token operator">:</span> <span class="token string">&quot;Transaction is not valid.&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>tx<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;register&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// Checks that a signature was made by the srcAddress that initiated the transaction</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>tx<span class="token punctuation">.</span>sign<span class="token punctuation">.</span>owner <span class="token operator">!==</span> tx<span class="token punctuation">.</span>srcAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token string">&quot;not signed by source account&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// Checks that the transaction wasn't modified from when it was originally signed</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>crypto<span class="token punctuation">.</span><span class="token function">verifyObj</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token string">&quot;incorrect signing&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// Business logic to check if a user handle already exists in the state data</span>
      <span class="token keyword">const</span> handles <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>accounts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">account</span> <span class="token operator">=&gt;</span> account<span class="token punctuation">.</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>handles<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>handle<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token string">&quot;This handle is already taken&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// Everything passed the validation criteria</span>
      response<span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token string">&quot;pass&quot;</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token string">&quot;This transaction is valid!&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//... More cases go here to verify other transaction types you may have</span>

    <span class="token comment">// Default branch reached, meaning the transaction type that was given doesn't match any exposed by your application</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      response<span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">type must be &quot;register&quot;, &quot;message&quot;, &quot;friend&quot;, &quot;toll&quot;, or &quot;node_reward&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> response<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs2/source/sdk-reference/shardus-app-interface/validate-transaction-fields.html" class="prev">
        Validate Transaction Fields
      </a></span> <span class="next"><a href="/docs2/source/sdk-reference/configuration-parameters/default-logs-config.html">
        Default Logs Config
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs2/assets/js/app.4fedb86a.js" defer></script><script src="/docs2/assets/js/2.3fd0cf3c.js" defer></script><script src="/docs2/assets/js/56.a43a8ca0.js" defer></script>
  </body>
</html>
