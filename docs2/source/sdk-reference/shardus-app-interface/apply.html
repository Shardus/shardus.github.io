<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Apply | Developer Docs</title>
    <meta name="description" content="Shardus Documentation Developer Docs">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/docs2/assets/css/0.styles.a15dee42.css" as="style"><link rel="preload" href="/docs2/assets/js/app.4fedb86a.js" as="script"><link rel="preload" href="/docs2/assets/js/2.3fd0cf3c.js" as="script"><link rel="preload" href="/docs2/assets/js/40.f134f176.js" as="script"><link rel="prefetch" href="/docs2/assets/js/10.c8f90647.js"><link rel="prefetch" href="/docs2/assets/js/11.37afdd34.js"><link rel="prefetch" href="/docs2/assets/js/12.d4808882.js"><link rel="prefetch" href="/docs2/assets/js/13.89c0170a.js"><link rel="prefetch" href="/docs2/assets/js/14.0650ba29.js"><link rel="prefetch" href="/docs2/assets/js/15.6b3c6a63.js"><link rel="prefetch" href="/docs2/assets/js/16.94b4b93c.js"><link rel="prefetch" href="/docs2/assets/js/17.e52dce7c.js"><link rel="prefetch" href="/docs2/assets/js/18.805f0b18.js"><link rel="prefetch" href="/docs2/assets/js/19.64845a7b.js"><link rel="prefetch" href="/docs2/assets/js/20.395bbe02.js"><link rel="prefetch" href="/docs2/assets/js/21.060e90c4.js"><link rel="prefetch" href="/docs2/assets/js/22.69ee7234.js"><link rel="prefetch" href="/docs2/assets/js/23.730f4a89.js"><link rel="prefetch" href="/docs2/assets/js/24.e9661cf2.js"><link rel="prefetch" href="/docs2/assets/js/25.b88ed052.js"><link rel="prefetch" href="/docs2/assets/js/26.0a46c1b0.js"><link rel="prefetch" href="/docs2/assets/js/27.d1a5d31e.js"><link rel="prefetch" href="/docs2/assets/js/28.b03d88a5.js"><link rel="prefetch" href="/docs2/assets/js/29.926bb12f.js"><link rel="prefetch" href="/docs2/assets/js/3.d41181b0.js"><link rel="prefetch" href="/docs2/assets/js/30.fc7d3d57.js"><link rel="prefetch" href="/docs2/assets/js/31.d4e4aa7d.js"><link rel="prefetch" href="/docs2/assets/js/32.b4459487.js"><link rel="prefetch" href="/docs2/assets/js/33.3a0ede7d.js"><link rel="prefetch" href="/docs2/assets/js/34.86c50212.js"><link rel="prefetch" href="/docs2/assets/js/35.89be3532.js"><link rel="prefetch" href="/docs2/assets/js/36.09e568d9.js"><link rel="prefetch" href="/docs2/assets/js/37.ea9bfe32.js"><link rel="prefetch" href="/docs2/assets/js/38.0c09315a.js"><link rel="prefetch" href="/docs2/assets/js/39.d5eba328.js"><link rel="prefetch" href="/docs2/assets/js/4.bdc95c51.js"><link rel="prefetch" href="/docs2/assets/js/41.2edff556.js"><link rel="prefetch" href="/docs2/assets/js/42.49878b4e.js"><link rel="prefetch" href="/docs2/assets/js/43.c99e0426.js"><link rel="prefetch" href="/docs2/assets/js/44.6bce92a7.js"><link rel="prefetch" href="/docs2/assets/js/45.efc9c512.js"><link rel="prefetch" href="/docs2/assets/js/46.567954e6.js"><link rel="prefetch" href="/docs2/assets/js/47.ac9ca5d5.js"><link rel="prefetch" href="/docs2/assets/js/48.e64957d7.js"><link rel="prefetch" href="/docs2/assets/js/49.1cdf48ac.js"><link rel="prefetch" href="/docs2/assets/js/5.70dbfd4e.js"><link rel="prefetch" href="/docs2/assets/js/50.a66c1e36.js"><link rel="prefetch" href="/docs2/assets/js/51.024c1df3.js"><link rel="prefetch" href="/docs2/assets/js/52.01271f85.js"><link rel="prefetch" href="/docs2/assets/js/53.e7bf447f.js"><link rel="prefetch" href="/docs2/assets/js/54.44e77f2a.js"><link rel="prefetch" href="/docs2/assets/js/55.da9796f2.js"><link rel="prefetch" href="/docs2/assets/js/56.a43a8ca0.js"><link rel="prefetch" href="/docs2/assets/js/57.192b008d.js"><link rel="prefetch" href="/docs2/assets/js/58.b6af1112.js"><link rel="prefetch" href="/docs2/assets/js/6.e910ed1d.js"><link rel="prefetch" href="/docs2/assets/js/7.6d6a826f.js"><link rel="prefetch" href="/docs2/assets/js/8.a3f31b66.js"><link rel="prefetch" href="/docs2/assets/js/9.0a5314d4.js">
    <link rel="stylesheet" href="/docs2/assets/css/0.styles.a15dee42.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs2/" class="home-link router-link-active"><img src="/docs2/logo.png" alt="Developer Docs" class="logo"> <span class="site-name can-hide">Developer Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Installation</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Main Concepts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SDK Reference</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/docs2/source/sdk-reference/shardus-app-interface/source/sdk-reference/shardus-app-interface/shardus-app-interface.html" class="sidebar-heading clickable open"><span>Shardus App Interface</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs2/source/sdk-reference/shardus-app-interface/apply.html" class="active sidebar-link">Apply</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/calculate-account-hash.html" class="sidebar-link">Calculate account hash</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/close.html" class="sidebar-link">Close</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/delete-account-data.html" class="sidebar-link">Delete Account Data</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/get-account-data-by-list.html" class="sidebar-link">getAccountDataByList</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/get-account-data-by-range.html" class="sidebar-link">getAccountDataByRange</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/get-account-data.html" class="sidebar-link">Get account data</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/get-account-debug-value.html" class="sidebar-link">Get account debug value</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/get-key-from-transaction.html" class="sidebar-link">Get key from transaction</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/get-relevant-data.html" class="sidebar-link">Get relevant data</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/register-external-get.html" class="sidebar-link">Register External Get</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/register-external-post.html" class="sidebar-link">Register External Post</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/reset-account-data.html" class="sidebar-link">Reset Account Data</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/update-account-full.html" class="sidebar-link">Update account full</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/validate-transaction-fields.html" class="sidebar-link">Validate Transaction Fields</a></li><li><a href="/docs2/source/sdk-reference/shardus-app-interface/validate-transaction.html" class="sidebar-link">Validate Transaction</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/docs2/source/sdk-reference/configuration-parameters/configuration-parameters.html" class="sidebar-heading clickable"><span>Configuration Parameters</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><a href="/docs2/source/support-and-feedback/raise-an-issue-on-gitlab.html" class="sidebar-link">Support and Feedback</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="apply"><a href="#apply" class="header-anchor">#</a> apply</h1> <p>Shardus expects a very important function called <code>apply</code> to be passed into <code>setup</code>. <code>apply</code> is where all your business logic lives that mutates your application state. Within <code>apply</code>, you also need to create a transactionId by hashing the transaction object, and pass it into <code>createApplyResponse</code>, which is another method exposed by shardus, along with the transaction timestamp as the second paremeter. This response should get returned at the end of <code>apply</code>.</p> <blockquote><p>It's crucially important that this is the only place where state data gets changed because all nodes basically run the apply function simultaniously. This enables the nodes to agree on what order the changes to state were made, and to be in sync with each other.</p></blockquote> <blockquote><p>When you mutate your application state data anywhere outside of <code>apply</code>, you end up causing the nodes to become out of sync. If you try this while running a network of nodes, you can actually see the node getting kicked out on the monitor server. Every other node has different state data than the one who changed his state prematurely, and they will boot him from the network.</p></blockquote> <p>The example shown in the main Interface Overview displayed a good example of what basically goes on in apply</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&quot;transfer&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> sourceAccount <span class="token operator">=</span> accountStates<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>sourceAddress<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">let</span> targetAccount <span class="token operator">=</span> accountStates<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>targetAddress<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>

  sourceAccount<span class="token punctuation">.</span>balance <span class="token operator">-=</span> amount<span class="token punctuation">;</span> <span class="token comment">// Take from source</span>
  targetAccount<span class="token punctuation">.</span>balance <span class="token operator">+=</span> amount<span class="token punctuation">;</span> <span class="token comment">// Give to target</span>

  sourceAccount<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> tx<span class="token punctuation">.</span>timestamp<span class="token punctuation">;</span>
  targetAccount<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> tx<span class="token punctuation">.</span>timestamp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>For an simple transaction type like a transfer, all that's required to happen is the source account balance getting deducted and the target account balance getting credited. That's it! You can see how writing decentralized applications just got a whole lot easier.</p></blockquote> <p>Let's take a look at a more fully fledged chat application's implementation of apply...</p> <blockquote><p>A good way of implementing the <code>apply</code> function is to use a switch statement, just like we did in <code>validateTransaction</code>. This way, only the code in the case for the specific transaction type will be executed. Any time you need to access account states to modify data, you need to grab it from the second argument <code>wrappedStates</code> that gets passed in to apply.</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// wrappedStates is a wrappedVersion of all the account states, which it</span>
<span class="token comment">// gets from the keys given to the transaction</span>
<span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">tx<span class="token punctuation">,</span> wrappedStates</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// This is where the validateTransaction comes into play</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> result<span class="token punctuation">,</span> reason <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">validateTransaction</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!==</span> <span class="token string">&quot;pass&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">invalid transaction, reason: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reason<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. tx: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Get the source and target account data, if they exist</span>
  <span class="token keyword">let</span> source <span class="token operator">=</span> wrappedStates<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>srcAcc<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> wrappedStates<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>srcAcc<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">let</span> target <span class="token operator">=</span> wrappedStates<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>tgtAcc<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> wrappedStates<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>tgtAcc<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>

  <span class="token comment">// Create an applyResponse which will be used to tell Shardus that the tx has been applied</span>
  <span class="token keyword">const</span> txId <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">hashObj</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// compute from tx</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Attempting to apply tx&quot;</span><span class="token punctuation">,</span> txId<span class="token punctuation">,</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> applyResponse <span class="token operator">=</span> dapp<span class="token punctuation">.</span><span class="token function">createApplyResponse</span><span class="token punctuation">(</span>txId<span class="token punctuation">,</span> tx<span class="token punctuation">.</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Apply the tx</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>tx<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;register&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      source<span class="token punctuation">.</span>handle <span class="token operator">=</span> tx<span class="token punctuation">.</span>handle<span class="token punctuation">;</span>
      <span class="token comment">// Just for testing purposes, we'll initially give the source account 1000 tokens to play with</span>
      source<span class="token punctuation">.</span>data<span class="token punctuation">.</span>balance <span class="token operator">+=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
      source<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> tx<span class="token punctuation">.</span>timestamp<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Applied register tx&quot;</span><span class="token punctuation">,</span> txId<span class="token punctuation">,</span> accounts<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>srcAcc<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">&quot;message&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      source<span class="token punctuation">.</span>data<span class="token punctuation">.</span>balance <span class="token operator">-=</span> tx<span class="token punctuation">.</span>amount<span class="token punctuation">;</span>
      target<span class="token punctuation">.</span>data<span class="token punctuation">.</span>balance <span class="token operator">+=</span> tx<span class="token punctuation">.</span>amount<span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>source<span class="token punctuation">.</span>data<span class="token punctuation">.</span>chats<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>tgtAcc<span class="token punctuation">]</span><span class="token punctuation">)</span> source<span class="token punctuation">.</span>data<span class="token punctuation">.</span>chats<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>tgtAcc<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> sent<span class="token operator">:</span> <span class="token punctuation">[</span>tx<span class="token punctuation">.</span>message<span class="token punctuation">]</span><span class="token punctuation">,</span> received<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> source<span class="token punctuation">.</span>data<span class="token punctuation">.</span>chats<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>tgtAcc<span class="token punctuation">]</span><span class="token punctuation">.</span>sent<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>target<span class="token punctuation">.</span>data<span class="token punctuation">.</span>chats<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>srcAcc<span class="token punctuation">]</span><span class="token punctuation">)</span> target<span class="token punctuation">.</span>data<span class="token punctuation">.</span>chats<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>srcAcc<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> sent<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> received<span class="token operator">:</span> <span class="token punctuation">[</span>tx<span class="token punctuation">.</span>message<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> target<span class="token punctuation">.</span>data<span class="token punctuation">.</span>chats<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>srcAcc<span class="token punctuation">]</span><span class="token punctuation">.</span>received<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

      source<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> tx<span class="token punctuation">.</span>timestamp<span class="token punctuation">;</span>
      target<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> tx<span class="token punctuation">.</span>timestamp<span class="token punctuation">;</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Applied message tx&quot;</span><span class="token punctuation">,</span> txId<span class="token punctuation">,</span> accounts<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>srcAcc<span class="token punctuation">]</span><span class="token punctuation">,</span> accounts<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>tgtAcc<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">&quot;toll&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      source<span class="token punctuation">.</span>data<span class="token punctuation">.</span>balance <span class="token operator">-=</span> tx<span class="token punctuation">.</span>amount<span class="token punctuation">;</span>
      source<span class="token punctuation">.</span>data<span class="token punctuation">.</span>toll <span class="token operator">=</span> tx<span class="token punctuation">.</span>toll<span class="token punctuation">;</span>
      source<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> tx<span class="token punctuation">.</span>timestamp<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Applied toll tx&quot;</span><span class="token punctuation">,</span> txId<span class="token punctuation">,</span> accounts<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>srcAcc<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">&quot;friend&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      source<span class="token punctuation">.</span>data<span class="token punctuation">.</span>balance <span class="token operator">-=</span> tx<span class="token punctuation">.</span>amount<span class="token punctuation">;</span>
      source<span class="token punctuation">.</span>data<span class="token punctuation">.</span>friends<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>handle<span class="token punctuation">]</span> <span class="token operator">=</span> tx<span class="token punctuation">.</span>tgtAcc<span class="token punctuation">;</span>
      source<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> timestamp<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Applied friend tx&quot;</span><span class="token punctuation">,</span> txId<span class="token punctuation">,</span> accounts<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>srcAcc<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">&quot;node_reward&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      target<span class="token punctuation">.</span>data<span class="token punctuation">.</span>balance <span class="token operator">+=</span> tx<span class="token punctuation">.</span>amount<span class="token punctuation">;</span>
      source<span class="token punctuation">.</span>nodeRewardTime <span class="token operator">=</span> tx<span class="token punctuation">.</span>timestamp<span class="token punctuation">;</span>
      source<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> tx<span class="token punctuation">.</span>timestamp<span class="token punctuation">;</span>
      target<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> tx<span class="token punctuation">.</span>timestamp<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Applied node_reward tx&quot;</span><span class="token punctuation">,</span> txId<span class="token punctuation">,</span> accounts<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>srcAcc<span class="token punctuation">]</span><span class="token punctuation">,</span> accounts<span class="token punctuation">[</span>tx<span class="token punctuation">.</span>tgtAcc<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> applyResponse<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>wrappedStates</code> is a very important argument that is generated from the keys sent in from the <code>getKeysFromTransaction</code> function. You need to parse the the account data from wrappedStates in order to properly modify any account state for that particular transaction.</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs2/source/main-concepts/spamming-the-network/spam-a-single-node.html" class="prev">
        Spam a single node
      </a></span> <span class="next"><a href="/docs2/source/sdk-reference/shardus-app-interface/calculate-account-hash.html">
        Calculate account hash
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs2/assets/js/app.4fedb86a.js" defer></script><script src="/docs2/assets/js/2.3fd0cf3c.js" defer></script><script src="/docs2/assets/js/40.f134f176.js" defer></script>
  </body>
</html>
